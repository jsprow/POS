<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Repleotech POS Log</title>
	<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
	<link rel="stylesheet" href="index.css">
</head>

<body class="log-body">
	<a id="close" class="close-btn">&#10006;</a>
	<table>
		<thead>
			<tr>
				<th id="timestamp">timestamp</th>
				<th id="first_name">first_name</th>
				<th id="last_name">last_name</th>
				<th id="birthdate">birthdate</th>
				<th id="mobile">mobile</th>
				<th id="points">points</th>
				<th id="email">email</th>
			</tr>
		</thead>
		<tbody id="logTable"></tbody>
	</table>

	<script src="ipc.js"></script>
	<script>
		var fs = require('fs');
		var logClose = document.getElementById('close');
		var logTable = document.getElementById('logTable');
		var logArr = [];
		var tdWidths = [];
		var $ = require('jquery');

		ipcRenderer.on('synchronous-reply', (event, arg) => {
			readLog();
		});
		ipcRenderer.send('asynchronous-message', 'ping');

		function logModal() {
			ipcRenderer.messaging = {
				sendCloseLogWindow: function() {
					ipcRenderer.send('close-second-window', 'an-argument')
				},

				init: function() {
					logClose.addEventListener('click', function() {
						ipcRenderer.messaging.sendCloseLogWindow();
					});
				}
			};
			ipcRenderer.messaging.init();
		}
		logModal();

		function readLog() {
			logTable.innerHTML = '';
			fs.readFile(path + '/log.txt', 'utf8', (err, data) => {
				if (err) throw err;
				let logJSON = data;
				let logSplit = logJSON.split('\n');

				for (var i in logSplit) {
					if (logSplit[i]) {
						let logEntry = JSON.parse(logSplit[i]),
							timestamp = logEntry.timestamp,
							first = logEntry.first,
							last = logEntry.last,
							birthdate = logEntry.birthdate,
							mobile = logEntry.mobile,
							points = logEntry.points,
							email = logEntry.email,

							row = document.createElement('tr'),
							tdTimestamp = document.createElement('td'),

							tdFirst = document.createElement('td'),
							tdLast = document.createElement('td'),
							tdBirthdate = document.createElement('td'),
							tdMobile = document.createElement('td'),
							tdPoints = document.createElement('td'),
							tdEmail = document.createElement('td');

						tdTimestamp.classList.add('timestamp');
						tdFirst.classList.add('first');
						tdLast.classList.add('last');
						tdBirthdate.classList.add('birthdate');
						tdMobile.classList.add('mobile');
						tdPoints.classList.add('points');
						tdEmail.classList.add('email');

						tdTimestamp.innerHTML = timestamp;
						tdFirst.innerHTML = first;
						tdLast.innerHTML = last;
						tdBirthdate.innerHTML = birthdate;
						tdMobile.innerHTML = mobile;
						tdPoints.innerHTML = points;
						tdEmail.innerHTML = email;

						row.appendChild(tdTimestamp);
						row.appendChild(tdFirst);
						row.appendChild(tdLast);
						row.appendChild(tdBirthdate);
						row.appendChild(tdMobile);
						row.appendChild(tdPoints);
						row.appendChild(tdEmail);

						logTable.appendChild(row);
					}
				}
			});
		}
	</script>
</body>

</html>
